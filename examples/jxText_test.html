<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>JX Text Test</title>
	<link rel="stylesheet" href="./jquery.nstSlider.min.css">
	<script src="../build/three.js" ></script>
	<script src="../src/alloyimage.js" ></script>
	<script src="../src/JX.js" ></script>
	<script src="../src/JXNode.js" ></script>
	<script src="../src/JXGroup.js" ></script>
	<script src="../src/JXPath.js" ></script>
	<script src="../src/JXText.js" ></script>
	<script src="../src/JXSprite.js" ></script>
	<script src="../src/JXPolygonMask.js" ></script>
	<script src="../src/JXSpriteLoader.js" ></script>
	<script src="../src/JXTransformControls.js" ></script>
	<!--<script src="../src/JXFilterMath.js" ></script>
	<script src="../src/JXFilter.js" ></script>
	<script src="../src/JXFilterEasy.js" ></script>-->
	<script src="../src/JXShirtViewport2D.js" ></script>
	<script src="../src/JXCanvasRenderer.js" ></script>
	<script src="./jquery-1.11.2.min.js"></script>
	<script src="./jquery.arctext.js"></script>
	<script src="./jquery.nstSlider.min.js"></script>
</head>
<body>

<canvas id="viewport" width="870" height="960" style="background: url('./t-shirt_2_wht.jpg_')"></canvas>

<input type="text" id="changeContent" value="jia xiang mei aij">
<input type="text" id="changeArc" value="90">
<div class="nstSlider" data-range_min="-360" data-range_max="360" data-cur_min="80" typename="text_arc">
    <div class="leftGrip"></div>
</div>
<div class="nstSlider" data-range_min="2" data-range_max="60" data-cur_min="20" typename="text_size">
    <div class="leftGrip"></div>
</div>
<div class="nstSlider" data-range_min="0" data-range_max="20" data-cur_min="5"  typename="text_space">
    <div class="leftGrip"></div>
</div>

<div class="nstSlider" data-range_min="-360" data-range_max="360" data-cur_min="0"  typename="object_rotate">
    <div class="leftGrip"></div>
</div>

<div class="nstSlider" data-range_min="1" data-range_max="1000" data-cur_min="100"  typename="object_scale">
    <div class="leftGrip"></div>
</div>

<div class="leftLabel" />
<!-- <div>My     name is ZhengWeiFu  </div> -->
<span id="ex_test_01">the is all my test</span>
<script type="text/javascript">

(function() {
	
	// $("#ex_test_01").arctext({radius: 10, dir: 1, fitText: true});

	var canvas = document.getElementById("viewport");

	var change_arc = document.getElementById("changeArc");

	var change_content = document.getElementById("changeContent");

	var width = canvas.clientWidth, height = canvas.clientHeight, halfWidth = width/2, halfHeight = height/2;


	var text = new THREE.JX.JXText();
	text.content = change_content.value;
	text.color.setRGB(0.5, 0, 0.5);
	text.size = 40;
	text.useStroke = true;
	text.strokeColor.setRGB(1, 0.5, 0);
	text.strokeSize = 2;
	text.useShadow = true;
	text.shadowColor.setRGB(0.3, 0.3, 0.3);
	text.shadowDistance = 3;
	text.shadowBlur = 2;
	text.arc = Math.PI / 180 * parseInt(change_arc.value);
	text.space = 5;
	text.position.set(0, 80, 0);
	// text.scale.set(2, 2, 1);
	// text.rotation.z = Math.PI/4;
	// console.log(text.updateSubTransform());

	// var text2 = text.clone();
	// text2.rotation.z = Math.PI/8;
	// text2.position.set(40, 40, 0);
	// text2.scale.set(2, 5, 1);
	// console.log(text2);
	// 
	
	var sprite_loader = new THREE.JX.JXSpriteLoader();
	var sprite = sprite_loader.load("sprite_test2.jpg", function(_sprite) {
		// _sprite.imageData = AlloyImage(_sprite.image).ps("美肤").imgData
		viewport2d.update();
	});

	// sprite.ps = "复古";

	sprite.filters.push({name: "setHSI", args: [10, 5, 10, true]});
	sprite.filters.push({name: "toReverse"});

	// sprite.useStroke = true;
	// sprite.useShadow = true;

	// sprite.rotation.z = Math.PI/8;

	// sprite.scale.set(2, 3, 1);
	// 
	
	var sprite2 = new THREE.JX.JXSprite();
	sprite2.useStroke = true;

	var maskHalfWith = 1500, maskHalfHeight = 2000;
	var mask = new THREE.JX.JXPolygonMask([
		new THREE.Vector2(-maskHalfWith, maskHalfHeight), 
		new THREE.Vector2(maskHalfWith, maskHalfHeight), 
		new THREE.Vector2(maskHalfWith, -maskHalfHeight), 
		new THREE.Vector2(-maskHalfWith, -maskHalfHeight)
	]);

	mask.strokeColor.setRGB(0.2, 0.3, 0.9);

	var jxGroup = new THREE.JX.JXGroup();
	jxGroup.add(text, sprite);

	var jxPath1 = new THREE.JX.JXPath();
	jxPath1.fromSVGPath("M144.9,382.6L142.2,384.7L141.9,386.2L142.4,387.2L161.3,397.8L173.4,405.4L188.1,414L205,424L217.2,426.4L242.2,429.2L259.5,310L175.7,298.1L172.6,314.5L171,314.5L169.3,317.2L166.8,317L165.5,314.3L162.8,314L161.9,312.8L161,312.8L160,313.4L158.1,314.4L158,321.4L157.8,323.1L157.2,335.7L155.7,337.9L155.1,341.2L157.9,346.1L159.1,351.9L159.9,352.9L161,353.5L160.8,355.8L159.2,357.2L155.8,358.9L153.9,360.8L152.4,364.5L151.8,369.4L149,372.1L146.9,372.8L147,373.7L146.6,375.4L147,376.2L150.7,376.7L150.1,379.5L148.6,381.7L144.9,382.6z");
	
	var jxPath2 = new THREE.JX.JXPath();
	jxPath2.path.moveTo(10, 10);

	jxPath2.path.lineTo(10, 100);

	jxPath2.path.lineTo(100, 100);

	jxPath2.path.lineTo(100, 10);

	jxPath2.path.lineTo(10, 10);
	jxPath2.path.lineTo(-10, -10);

	var jxPathGroup = new THREE.JX.JXGroup();
	jxPathGroup.add(jxPath1, jxPath2);


	var shapeGroup = new THREE.Group();
	shapeGroup.add(jxGroup);
	shapeGroup.add(jxPathGroup);
	var viewport2d = new Viewport2D(canvas, shapeGroup, mask);


	change_arc.onchange = function(event) {
		text.arc = Math.PI/180 * parseInt(event.target.value);
		viewport2d.update();
	};

	change_content.onchange = function(event) {
		text.content = event.target.value;
		viewport2d.update();
	};

	$('.nstSlider').nstSlider({
	    "left_grip_selector": ".leftGrip",
	    "value_changed_callback": function(cause, leftValue, rightValue) {
	        $(this).parent().find('.leftLabel').text(leftValue);
	        var type_name = $(this).attr("typename");
	        switch (type_name) {
	        	case "text_arc":
	        		text.arc = Math.PI/180 * parseInt(leftValue);
	        		break;
	        	case "text_size":
	        		text.size = parseInt(leftValue);
	        		break;
	        	case "text_space":
	        		text.space = parseInt(leftValue);
	        		break;
	        	case "object_rotate":
	        		if(viewport2d.current_object) viewport2d.current_object.rotation.z = parseInt(leftValue) * Math.PI / 180;
	        		break;
	        	case "object_scale":
	        		if(viewport2d.current_object) {
		        		var s =  parseInt(leftValue) / 100;
		        		viewport2d.current_object.scale.x = s;
		        		viewport2d.current_object.scale.y = s;
		        		break;
	        		};
	        }

	        viewport2d.update();
	    }
	});
})();
</script>

</body>
</html>